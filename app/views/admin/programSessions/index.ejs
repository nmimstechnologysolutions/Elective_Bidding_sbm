<%- include("../partials/head") %>
<%- include("../partials/leftSidebar") %>
<%- include("../partials/header") %>

<div class="content d-flex flex-column">

    <div class="breadcrumbs-container">
        <ul class="breadcrumb">
            <% if(breadcrumbs){%> <% for (let crumbs of breadcrumbs){%>
                <li><a href="<%- crumbs.url%>"><%- crumbs.name%></a></li>
                <%} }%>
        </ul>
    </div>

    <div class="mb-4 d-flex justify-content-between align-items-center">
        <h1 class="page-title">Program Sessions</h1>
        <button class="btn event-btn" id="get-program-sessions-btn">Refresh</button>
    </div>

    <!-- <div class="mb-3 row">
        <div class="col-lg-1 col-md-2">
            <select id="set-entries">   
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="75">75</option>
                <option value="100">100</option>
            </select>
        </div>
    </div> -->

    <div class="card border-0 flex-grow-1 table-responsive">
        <table class="w-100">
            <thead>
                <tr class="table-head-row">
                    <th>#</th>
                    <th>Acad Session</th>
                    <th>Program Name</th>
                    <th>Academic Year</th>
                    <th>Minimum Credits</th>
                    <th>Maximum Credits</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody class="table-body">
                <% if(programSessionList.length > 0){ %>
                    <% programSessionList.forEach((session, idx)=> { %>
                        <tr>
                            <td><%= idx+1 %></td>
                            <td><%= session.acad_session %></td>
                            <td><%= session.program_name %></td>
                            <td><%= session.year %></td>
                            <td><%= session.min_credits %></td>
                            <td><%= session.max_credits %></td>
                            <td>
                                <button class="border-0 bg-transparent ms-1" 
                                    data-session-id = "<%= session.id %>"
                                    data-acad-session = "<%= session.acad_session %>"
                                    data-min-credits = "<%= session.min_credits %>"
                                    data-max-credits = "<%= session.max_credits %>"
                                    data-bs-toggle="modal" data-bs-target="#edit-program-session-modal">
                                    <i class="fa fa-pencil-alt" style="font-size: 18px; color: green;"></i>
                                </button>
                            </td>
                        </tr>
                    <% }) %>
                <% }else { %>
                    <tr>
                        <td colspan="7">No Program Sessions Data</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
    

    <!-- Modal -->

    <div class="modal fade" id="edit-program-session-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Edit Program Session</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="fs-5">Acad Session : <span class="fw-semibold" id="update-acad-session-name"></span></p>
                    <div class="row">
                        <div class="col-md-6 col-12 d-flex flex-column gap-1">
                            <label class="modal-label">Minimum Credits</label>
                            <input type="number" class="modal-input" id="update-min-credits" placeholder="Enter Course Credits">
                        </div>
                        <div class="mt-2 mt-md-0 col-md-6 col-12 d-flex flex-column gap-1">
                            <label class="modal-label">Maximum Credits</label>
                            <input type="number" class="modal-input" id="update-max-credits" placeholder="Enter Demand Criteria">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn event-btn" id="confirm-save-program-session-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    

</div>

<%- include("../partials/footer") %>
<script>

    setActiveMenuItem(`<%- active %>`)

    $("#set-entries").selectize()

    $("#get-program-sessions-btn").on("click", function(){
        
        let ApiObj = {
            type : "POST",
            url : "/admin/program-sessions/program-session-by-refresh",
            data : {},
            dataType : JSON
        }

        ajaxApi(ApiObj).then(result => {
            toast.success(result.description)
            setTimeout(()=> {
                location.reload()
            }, [3000])
        }).catch(error => {
            toast.error(error.responseJSON.description)
        })
    })

    $("#edit-program-session-modal").on("show.bs.modal", function(event){
        const btn = event.relatedTarget
        const programSessionId = btn.getAttribute("data-session-id")
        const acadSession = btn.getAttribute("data-acad-session")
        const sessionMinCredits = btn.getAttribute("data-min-credits")
        const sessionMaxCredits = btn.getAttribute("data-max-credits")
        $("#update-acad-session-name").text(acadSession)
        $("#update-min-credits").val(sessionMinCredits)
        $("#update-max-credits").val(sessionMaxCredits)
        $("#confirm-save-program-session-btn").attr('data-program-session-id', programSessionId)
    })
    

    $("#confirm-save-program-session-btn").on("click", function(){
        const programSessionId = $(this).attr("data-program-session-id")
        const sessionMinCredits = $("#update-min-credits").val()
        const sessionMaxCredits = $("#update-max-credits").val()

        const inputJSON = {
            id : programSessionId,
            min_credits : sessionMinCredits,
            max_credits : sessionMaxCredits
        }

        let ApiObj = {
            url : '/admin/program-sessions/update-program-session',
            type : 'POST',
            data : {
                inputJSON : JSON.stringify(inputJSON)
            },
            datatype : 'JSON'
        }

        ajaxApi(ApiObj).then(result => {
            toast.success(result.description)
            $("#edit-program-session-modal").modal('hide')
            setTimeout(()=>{
                location.reload()
            },[3000])
        }).catch(err => {
            toast.error(err.responseJSON.description)
        })

    })



</script>
<%- include("../partials/footerEnd") %>
